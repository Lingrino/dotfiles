- name: Disable resume
  osx_defaults:
    state: present
    domain: com.apple.systempreferences
    key: NSQuitAlwaysKeepsWindows
    type: bool
    value: false

- name: Disable auto termination of inactive apps
  osx_defaults:
    state: present
    domain: NSGlobalDomain
    key: NSDisableAutomaticTermination
    type: bool
    value: true

- name: Ask for password after sleep/screensaver
  osx_defaults:
    state: present
    domain: com.apple.screensaver
    key: askForPassword
    type: int
    value: 1

- name: Require password immediately after sleep/screensaver
  osx_defaults:
    state: present
    domain: com.apple.screensaver
    key: askForPasswordDelay
    type: int
    value: 0

- name: Disable sleep when idle
  block:
    - name: Get current sleep setting
      command: systemsetup -getcomputersleep
      become: true
      become_user: root
      register: R_sleep_info
      changed_when:
        - R_sleep_info.stderr != ""

    - name: Disable sleep when idle
      command: systemsetup -setcomputersleep Off
      become: true
      become_user: root
      register: R_sleep_disable
      changed_when:
        - (R_sleep_disable.stderr != "") or
          ("Never" not in R_sleep_info.stdout)
  tags:
    - sudo
