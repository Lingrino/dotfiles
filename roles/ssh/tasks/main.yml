- name: Create the ssh directory
  file:
    state: directory
    path: "{{ ansible_env.HOME }}/.ssh"
    mode: 0700
    owner: "{{ ansible_user_id }}"
  register: R_ssh_dir

- name: Copy over the ssh config file
  copy:
    src: config
    dest: "{{ R_ssh_dir.path }}/config"
    mode: 0600
    owner: "{{ ansible_user_id }}"

- name: Copy my private key to personal
  copy:
    content: "{{ lookup('onepassword_raw', 'SSH - Personal Main Private', subdomain=op_subdomain, username=op_email, vault_password=op_password, secret_key=op_secret_key) | json_query('details.notesPlain') }}"
    dest: "{{ ansible_env.HOME }}/.ssh/personal"
    mode: 0600
    owner: "{{ ansible_user_id }}"
  no_log: true
  tags:
    - post
    - 1password

- name: Copy my public key to personal.pub
  copy:
    content: "{{ lookup('onepassword_raw', 'SSH - Personal Main Public', subdomain=op_subdomain, username=op_email, vault_password=op_password, secret_key=op_secret_key) | json_query('details.notesPlain') }}"
    dest: "{{ ansible_env.HOME }}/.ssh/personal.pub"
    mode: 0600
    owner: "{{ ansible_user_id }}"
  no_log: true
  tags:
    - post
    - 1password

- name: Copy my private key to work
  copy:
    content: "{{ lookup('onepassword_raw', 'SSH - Personal Work Private', subdomain=op_subdomain, username=op_email, vault_password=op_password, secret_key=op_secret_key) | json_query('details.notesPlain') }}"
    dest: "{{ ansible_env.HOME }}/.ssh/work"
    mode: 0600
    owner: "{{ ansible_user_id }}"
  no_log: true
  tags:
    - post
    - 1password

- name: Copy my public key to work.pub
  copy:
    content: "{{ lookup('onepassword_raw', 'SSH - Personal Work Public', subdomain=op_subdomain, username=op_email, vault_password=op_password, secret_key=op_secret_key) | json_query('details.notesPlain') }}"
    dest: "{{ ansible_env.HOME }}/.ssh/work.pub"
    mode: 0600
    owner: "{{ ansible_user_id }}"
  no_log: true
  tags:
    - post
    - 1password
