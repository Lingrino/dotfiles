#!/bin/sh

# This function wraps the 'op' function with a simple way of storing the
# token in a file and checking if it is valid before running the actual
# command. This lets you share tokens across sessions and also moves the
# login flow within the actual command

export OP_SESSION_my="$(cat ~/.op/token)"

while ! /usr/local/bin/op list vaults &> /dev/null; do
   echo "$(/usr/local/bin/op signin my --output=raw)" > ~/.op/token
   export OP_SESSION_my="$(cat ~/.op/token)"
done

/usr/local/bin/op "$@"
