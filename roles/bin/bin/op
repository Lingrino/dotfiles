#!/bin/sh

# This function wraps the 'op' function with a simple way of storing the
# token in a file and checking if it is valid before running the actual
# command. This lets you share tokens across sessions

# Get a list of all op accounts
accounts=$(cat ~/.op/config | jq -r '.accounts[].shorthand')

# Export all op sessions
for account in $accounts; do
   if [-f ~/.op/token-${account}]; then
      export OP_SESSION_${account}="$(cat ~/.op/token-${account})"
   fi
done

/usr/local/bin/op "$@"
