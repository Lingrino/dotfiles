- name: Clone zsh-completions into our zsh directory
  git:
    repo: https://github.com/zsh-users/zsh-completions.git
    dest: "/usr/local/share/zsh/completions"
    clone: true
    depth: 1
    update: true
    version: master
  tags:
    - internet

- name: Clone zsh-autosuggestions into our zsh directory
  git:
    repo: https://github.com/zsh-users/zsh-autosuggestions.git
    dest: "/usr/local/share/zsh/autosuggestions"
    clone: true
    depth: 1
    update: true
    version: master
  tags:
    - internet

- name: Clone zsh-syntax-highlighting into our zsh directory
  git:
    repo: https://github.com/zsh-users/zsh-syntax-highlighting.git
    dest: "/usr/local/share/zsh/syntax-highlighting"
    clone: true
    depth: 1
    update: true
    version: master
  tags:
    - internet

- name: Write the zsh rc file
  template:
    src: zshrc.zsh.j2
    dest: "{{ ansible_env.HOME }}/.zshrc"
    mode: 0700
    owner: "{{ ansible_user_id }}"

- name: Write /etc/shells
  copy:
    src: shells
    dest: /etc/shells
    mode: 0644
  become: true
  become_user: root
  tags:
    - sudo

- name: Use zsh as my default shell
  user:
    name: "{{ ansible_user_id }}"
    shell: /usr/local/bin/zsh
  become: true
  become_user: root
  tags:
    - sudo
